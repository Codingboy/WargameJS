<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<title>BFT</title>
	</head>
	<body>
		<div class="container">
			<form class="form-horizontal">
				<div class="form-group" id="unitBlock">
					<input type="button" onclick="showGroups()" value="Groups"/>
					<input type="button" onclick="showInfantry()" value="Infantry"/>
				</div>
				<div class="form-group" id="buttonsBlock">
				</div>
			<form>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="core.js"></script>
		<script>
			var db;
			function init()
			{
				window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
				window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
				window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
				initDB(function(event)
				{
					db = event.target.result;
				});
			}
			init();
			function reset()
			{
				let groupsElement = document.getElementById("buttonsBlock");
				for (let i=0; i<groupsElement.childNodes.length; i++)
				{
					if (groupsElement.childNodes[i])
					{
						let group = groupsElement.removeChild(groupsElement.childNodes[i]);
					}
				}
			}
			function showGroups()
			{
				reset();
				let name = gup("deck");
				let req = db.transaction(["decks"]).objectStore("decks").get(name);
				req.onsuccess = function(event)
				{
					if (req.result)
					{
						let deck = req.result;
						for (let group of deck.groups)
						{
							addGroup(group);
						}
					}
				};
			}
			function showInfantry()
			{
				reset();
				let name = gup("deck");
				let req = db.transaction(["decks"]).objectStore("decks").get(name);
				req.onsuccess = function(event)
				{
					if (req.result)
					{
						let deck = req.result;
						for (let unit of deck.units)
						{
							//TODO filter infantry
							addUnit(unit);
						}
					}
				};
			}
			function addUnit(unit)
			{
				let units = document.getElementById("buttonsBlock");
				let button = document.createElement("input");
				button.type = "button";
				button.value = unit;
				button.onclick = function()
				{
					let unit = this.value;
					//TODO prepare for spawn
				};
				units.appendChild(button);
			}
			function addGroup(group)
			{
				let groups = document.getElementById("buttonsBlock");
				let button = document.createElement("input");
				button.type = "button";
				button.value = group;
				button.onclick = function()
				{
					let group = this.value;
					//TODO prepare for spawn
				};
				groups.appendChild(button);
			}
		</script>
	</body>
</html>
